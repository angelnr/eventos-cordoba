name: ğŸ” DEBUG SSH SETUP

on:
  push:
    branches: [ main ]

jobs:
  debug-ssh:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: 1ï¸âƒ£ Check Private Key Format
      run: |
        echo "ğŸ” Analizando formato de la clave privada..."
        mkdir -p ~/.ssh
        
        # Verificar el contenido REAL del secret
        echo "=== CONTENIDO COMPLETO DE SSH_PRIVATE_KEY ==="
        echo "${{ secrets.SSH_PRIVATE_KEY }}"
        echo "=== FIN DEL CONTENIDO ==="
        
        # Contar lÃ­neas
        LINE_COUNT=$(echo "${{ secrets.SSH_PRIVATE_KEY }}" | wc -l)
        echo "ğŸ“Š LÃ­neas en la clave: $LINE_COUNT"
        
        # Verificar que comience y termine correctamente
        echo "${{ secrets.SSH_PRIVATE_KEY }}" | head -1 | grep -q "BEGIN OPENSSH PRIVATE KEY" && echo "âœ… Inicio correcto" || echo "âŒ Inicio incorrecto"
        echo "${{ secrets.SSH_PRIVATE_KEY }}" | tail -1 | grep -q "END OPENSSH PRIVATE KEY" && echo "âœ… Fin correcto" || echo "âŒ Fin incorrecto"
        
    - name: 2ï¸âƒ£ Create SSH Key File
      run: |
        echo "ğŸ”§ Creando archivo de clave..."
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        
        echo "ğŸ“„ Verificando archivo creado:"
        ls -la ~/.ssh/id_rsa
        echo "=== PRIMERAS 5 LÃNEAS ==="
        head -5 ~/.ssh/id_rsa
        echo "=== ÃšLTIMAS 5 LÃNEAS ==="  
        tail -5 ~/.ssh/id_rsa
        
    - name: 3ï¸âƒ£ Set Permissions
      run: |
        echo "ğŸ” Aplicando permisos..."
        chmod 700 ~/.ssh
        chmod 600 ~/.ssh/id_rsa
        
        echo "âœ… Permisos aplicados:"
        ls -la ~/.ssh/
        
    - name: 4ï¸âƒ£ Test Key Format
      run: |
        echo "ğŸ”‘ Probando formato de clave..."
        ssh-keygen -l -f ~/.ssh/id_rsa && echo "âœ… Formato de clave vÃ¡lido" || echo "âŒ Formato de clave invÃ¡lido"
